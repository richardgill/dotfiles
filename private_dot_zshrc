export XDG_CONFIG_HOME="$HOME/.config"

# History
HISTFILE="$HOME/.zsh_history"
HISTSIZE=10000000
SAVEHIST=10000000
setopt EXTENDED_HISTORY          # Write the history file in the ":start:elapsed;command" format.
setopt INC_APPEND_HISTORY        # Write to the history file immediately, not when the shell exits.
setopt SHARE_HISTORY             # Share history between all sessions.
setopt HIST_IGNORE_ALL_DUPS      # Delete old recorded entry if new entry is a duplicate.
setopt HIST_VERIFY               # Don't execute immediately upon history expansion.

export EDITOR='nvim'

# EDITOR=vim sets zsh -o vim implicitly :|
bindkey -e

# setup zsh
if type brew &>/dev/null
then
  FPATH="$(brew --prefix)/share/zsh/site-functions:${FPATH}"

  autoload -Uz compinit
  compinit
fi

source $(brew --prefix)/share/zsh-autosuggestions/zsh-autosuggestions.zsh
source $(brew --prefix)/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh

# Oh my posh prompt
if [ "$TERM_PROGRAM" != "Apple_Terminal" ]; then
  eval "$(oh-my-posh init zsh --config $HOME/.config/oh-my-posh/oh-my-posh.toml)"
fi

# Auto-source tmux.conf if inside a tmux session
if [ -n "$TMUX" ]; then
  # EDITOR="nvim" and bindkey-e mess this up in tmux :|
  bindkey  "^[OH"   beginning-of-line
  bindkey  "^[OF"   end-of-line
  bindkey  "^[[3~"  delete-char
fi

# alt + left and right in /paths/like/this
autoload -U select-word-style
select-word-style bash

# ctrl + u only deletes from where the cursor is. (which is then bound to command + left elsewhere)
bindkey '^U' backward-kill-line

eval "$(zoxide init zsh --cmd cd)"
source <(fzf --zsh)

# Setup fnm (node version manager)
eval "$(fnm env)"
eval "$(fnm env --use-on-cd)"

# Setup rye (python version manager)
source "$HOME/.rye/env"

# Git aliases
alias s="git status"
alias d="git diff"
alias hard="git reset --hard"
alias add="git add ."
alias fetch="git fetch origin"
alias co="git checkout"
alias track="gh pr checkout"
alias pr="gh pr create"
alias wt="source ~/Scripts/worktree"
alias log="git log --graph --decorate --pretty=oneline --abbrev-commit"
alias soft="git reset --soft HEAD~1"
alias blame="git blame -w -C -C -C"
alias ghdiff='open "https://github.$(git config remote.origin.url | cut -f2 -d.)/compare/$(git rev-parse --abbrev-ref HEAD)?expand=1"'
alias bbdiff='open "$(git config remote.origin.url)/pull-requests/new#diff"'

ci() {
  if [ "$#" -eq 0 ]; then
    # No arguments provided, prompt for the commit message
    git commit
  else
    # Arguments provided, they form the commit message
    commit_message="$*"
    git commit -m "$commit_message"
  fi

}

branch() {
  git checkout -b "$1"
}

branches() {
  git branch -a
}

push() {
  if [ $# -eq 0 ]; then
    git push origin "$(git symbolic-ref --short HEAD)"
  else
    git push origin "$@"
  fi
}

pull() {
  if [ $# -eq 0 ]; then
    git pull origin "$(git symbolic-ref --short HEAD)"
  else
    git pull origin "$@"
  fi
}

resetTo() {
  target_branch="${1:-main}"
  git reset $(git merge-base origin/"$target_branch" $(git rev-parse --abbrev-ref origin/HEAD))
}

# app aliases
alias c="code"
alias v="nvim"
alias zed="open -a /Applications/Zed.app -n"
alias pnx="pnpm exec nx"
alias lso="/bin/ls"
alias ls="eza"
alias cato="/bin/cat"
alias cat="bat"
alias as="open -a /Applications/Android\ Studio.app"
alias vlc="/Applications/VLC.app/Contents/MacOS/VLC"
alias sed="gsed"
alias n='nnn -xRPaEH'

export NNN_USE_EDITOR=1
export NNN_PLUG="f:fzplug"

# Puppeteer
export PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true
export PUPPETEER_EXECUTABLE_PATH=`which chromium`

export RIPGREP_CONFIG_PATH="$XDG_CONFIG_HOME/ripgrep/.ripgreprc"

# bun
export BUN_INSTALL="$HOME/.bun"
export PATH="$BUN_INSTALL/bin:$PATH"

# bun completions
[ -s "$BUN_INSTALL/_bun" ] && source "$BUN_INSTALL/_bun"

# Path
export PATH="$PATH:$HOME/Scripts"
export PATH="$PATH:/Applications/Visual Studio Code.app/Contents/Resources/app/bin"
export PATH="$PATH:$HOME/Library/Android/sdk/platform-tools"

export PATH="~/.bun/bin:$PATH"
export PATH="$HOME/.deno/bin:$PATH"

# Android
export ANDROID_HOME=$HOME/Library/Android/sdk
export PATH=$PATH:$ANDROID_HOME/emulator
export PATH=$PATH:$ANDROID_HOME/platform-tools
export JAVA_HOME=/Library/Java/JavaVirtualMachines/zulu-17.jdk/Contents/Home

# For building firefox
export PATH="$HOME/.mozbuild/git-cinnabar:$PATH"
